name: Notify Discord on Release

on:
  release:
    types: [published]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send release info to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          RELEASE_NAME: ${{ github.event.release.name }}
          RELEASE_BODY: ${{ github.event.release.body }}
          RELEASE_URL: ${{ github.event.release.html_url }}
        run: |
          apt-get update && apt-get install -y jq

          curl -X POST -H "Content-Type: application/json" \
            -d "$(jq -n \
              --arg username "VelocityBroadcast Reborn Update Bot" \
              --arg avatar_url "https://imgur.com/WuW15Aq.png" \
              --arg title "$RELEASE_NAME" \
              --arg description "$RELEASE_BODY" \
              --arg url "$RELEASE_URL" \
              --argjson color 16711680 \
              '{
                username: $username,
                avatar_url: $avatar_url,
                embeds: [{
                  title: $title,
                  description: $description,
                  url: $url,
                  color: $color
                }]
              }')" \
            "$DISCORD_WEBHOOK"
